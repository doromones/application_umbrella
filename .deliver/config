APP="application_umbrella"

BUILD_HOST="virtualbox"
BUILD_USER="user"
BUILD_AT="/home/user/edeliver/build/application_umbrella"

STAGING_HOSTS="virtualbox"
STAGING_USER="user"
TEST_AT="/home/user/edeliver/build_apps/"

#if [[ "$APP" = "admin_web" ]]; then
#  BUILD_AT="${BUILD_AT}/apps/${APP}"
#fi

# set the build directory to the umbrella project dir
#pre_init_app_remotely() {
#  [[ "$APP" = "admin_web" ]] && set_git_project_directory
#}

# reset the build directory
#pre_erlang_get_and_update_deps() {
#  [[ "$APP" = "admin_web" ]] && restore_build_directory
#}

#set_git_project_directory() {
#  ACTUAL_PROJECT_DIR="$DELIVER_TO"
#  DELIVER_TO="$(dirname $DELIVER_TO)"
#}

#restore_build_directory() {
#  DELIVER_TO="$ACTUAL_PROJECT_DIR"
#}

#git_push() {
#    echo "disable git push"
#}

pre_erlang_clean_compile() {
    phoenix_digest 'admin_web'
}

phoenix_digest(){
    app=$1

    status "Running phoenix.digest for ${app}" # log output prepended with "----->"
    __sync_remote " # runs the commands on the build host
      [ -f ~/.profile ] && source ~/.profile # load profile (optional)
      set -e # fail if any command fails (recommended)
      cd "$BUILD_AT/apps/${app}"
      # prepare something
      mkdir -p priv/static # required by the phx.digest task
      # run your custom task
      APP='$APP' MIX_ENV='$TARGET_MIX_ENV' $MIX_CMD phx.digest $SILENCE
    "
}
